function s3(t,e){this.url=t,this.productName=e,this.prefix=this.productName}function getVersions(t,e,i){i($.map(t,function(t){return t.key.split("/")[1]}))}function bytesToHumanReadable(t){var e=-1,i=[" kB"," MB"," GB"];do t/=1024,e++;while(t>1024);return Math.max(t,.1).toFixed(1)+i[e]}function getArchString(t){if(void 0!=t){switch(platform=t.substring(0,3),platform){case"x86":platform+=" (32-bit)";break;case"x64":platform+=" (64-bit)"}return platform}return""}function getOS(t){switch(t){case"darwin":return"Mac";case"win32":return"Windows";case"linux":return"Linux"}}function getType(t,e){return"win32"!=t?"":"zip"===e?" (Portable)":"exe"===e?" (Installer)":void 0}function prettifyFileName(t){var e=t.split("-"),i=t.substring(t.lastIndexOf(".")+1,t.length);return e[0]+" for "+getOS(e[3])+" "+getArchString(e[4])+getType(e[3],i)}s3.prototype.getLatestVersion=function(t){var e=this,i=7;getData(this,function(n){getVersions(n.directories,"etcher",function(n){var r=[],o=3;async.eachLimit(n,o,function(t,n){getData({url:e.url,productName:e.productName,prefix:e.prefix+"/"+t},function(e){return e.files.length>=i&&r.push(t),n()})},function(e){return e?t(e):void t(r.sort(semver.rcompare)[0])})})})},s3.prototype.getFiles=function(t,e){this.prefix=this.prefix+"/"+t,getData(this,function(t){for(var i=0;i<t.files.length;i++)-1!==t.files[i].name.indexOf(".zip")&&-1!==t.files[i].name.indexOf("darwin")&&t.files.splice(i,1);e(t.files)})},s3.prototype.getDynamicLink=function(t,e,i,n){switch(e){case"macos":buttonText="Download for OSX >= 10.9",n(findLink(t,"darwin",buttonText,i));break;case"windows":buttonText="Download for Windows >= 7",n(findLink(t,"win32",buttonText,i));break;case"linux":buttonText="Download for Linux",n(findLink(t,"linux",buttonText,i));break;default:buttonText="Download for Windows >= 7",n(findLink(t,"win32",buttonText,i))}};var findLink=function(t,e,i,n){for(var r=[],o=0,a=t.length;a>o;o++)if(-1!=t[o].link.toLowerCase().indexOf(e)&&(t[o].buttonText=i,t[o].eventName=n,r.push(t[o])),o===a-1)return r};getData=function(t,e){query_url=t.url+"?delimiter=/&prefix="+t.prefix+"/",$.get(query_url).done(function(i){var n=$(i);e(parseXML(n,t))}).fail(function(t){console.error(t)})},parseXML=function(t,e){var i=$.map(t.find("Contents"),function(t){t=$(t);var i=t.find("Key").text().split("/")[2],n=i.split("-");return{name:i,prettyName:prettifyFileName(i),link:e.url+"/"+t.find("Key").text(),lastModified:t.find("LastModified").text(),size:bytesToHumanReadable(t.find("Size").text()),type:"file",os:getOS(n[3]),arch:getArchString(n[4])}}),n=$.map(t.find("CommonPrefixes"),function(t){return t=$(t),{key:t.find("Prefix").text(),lastModified:"",size:"0",type:"directory"}});return{files:i,directories:n,prefix:$(t.find("Prefix")[0]).text()}};